Bootstrap: docker
From: debian:stable-slim
Stage: devel

%files
    $HOME/Documents/apptainer-singularity-projects/includes/wahzb40nxr1lx0wz2zp0ks5k4i32avq8-myvesta-tarball-pack.tar.gz /wahzb40nxr1lx0wz2zp0ks5k4i32avq8-myvesta-tarball-pack.tar.gz

%post
    cd /
    tar -xzf wahzb40nxr1lx0wz2zp0ks5k4i32avq8-myvesta-tarball-pack.tar.gz
    rm -rf /wahzb40nxr1lx0wz2zp0ks5k4i32avq8-myvesta-tarball-pack.tar.gz


Bootstrap: docker
From: debian:stable-slim
Stage: devel


%files from devel
    /gnu /

%environment

%post
    ln -sf /gnu/store/kr29a3dk9d71cv9w1nzd925ai53gcc59-myvesta-3.5.8/bin/VESTA /usr/local/bin/VESTA
    # TODO
    # CORRECT ERROR MESSAGES
    """
    Apptainer> VESTA

    (VESTA-gui:18): dbind-WARNING **: 11:02:49.635: Couldn't connect to accessibility bus: Failed to connect to socket /run/user/1000/at-spi/bus: No such file or directory
    Gtk-Message: 11:02:50.125: Failed to load module \"canberra-gtk-module\"
    Gtk-Message: 11:02:50.136: Failed to load module \"canberra-gtk-module\"

    (VESTA-gui:18): Gtk-WARNING **: 11:02:50.663: Could not load a pixbuf from /org/gtk/libgtk/theme/Adwaita/assets/bullet-symbolic.svg.
    This may indicate that pixbuf loaders or the mime database could not be found.

    (VESTA-gui:18): Gtk-CRITICAL **: 11:02:50.921: gtk_box_gadget_distribute: assertion 'size >= 0' failed in GtkNotebook
    **
    Gtk:ERROR:../gtk+-3.24.37/gtk/gtkiconhelper.c:495:ensure_surface_for_gicon: assertion failed (error == NULL): Failed to load /org/gtk/libgtk/icons/16x16/status/image-missing.png: Unrecognized image file format (gdk-pixbuf-error-quark, 3)
    Bail out! Gtk:ERROR:../gtk+-3.24.37/gtk/gtkiconhelper.c:495:ensure_surface_for_gicon: assertion failed (error == NULL): Failed to load /org/gtk/libgtk/icons/16x16/status/image-missing.png: Unrecognized image file format (gdk-pixbuf-error-quark, 3)
    """
    

%runscript
    /usr/local/bin/VESTA

%test
    ls /gnu/store
    #/gnu/store/kr29a3dk9d71cv9w1nzd925ai53gcc59-myvesta-3.5.8/bin/VESTA

%help
    This container embedds VESTA (version 3.5.8).
    For more information about this image, please run "apptainer inspect <this-image>"

    As VESTA is a visualization tools, it requires additionnal information
    to successfully use your graphical ressources through the $DISPLAY
    environment variable. As such, you should call the present image as :
    $ apptainer run <OPTIONS> \
      --env DISPLAY=$(w -h $USER | awk '$2 ~ /:[0-9.]*/{print $2}') \
      <this-image>
    
    If you want to build a script which automatizes this graphical ressources
    management, you can use something like the following command.
    
    cat > my-vesta-script.sh << 'EOF'
        export HOST_DISPLAY=$(w -h $USER | awk '$2 ~ /:[0-9.]*/{print $2}')
        apptainer run <OPTIONS> \
            --env DISPLAY=$HOST_DISPLAY \
            <path-to-this-image>/<this-image>
    EOF
    
    You can also enter an interactive shell within the container with "apptainer shell <this-image>".
    However, please note almost no basic Linux command are available within the container 
    (both for portability and security reasons).

%labels
    Owner Copyright (C) 2006-2021, Koichi Momma and Fujio Izumi
    Author dylan.bissuel@univ-lyon1.fr
    Version 3.5.8
    MyLabel VESTA-version-3.5.8
    EntryPoint https://jp-minerals.org/vesta/en/